# CS-2D-GUI

二维下料问题求解器的 Qt6 图形界面，基于 CS-2D-BP-Arc 分支定价算法。

## 功能

- **数据导入**: 支持 CSV/TXT 格式的算例文件
- **参数配置**: 时间限制、SP1/SP2 子问题求解方法选择
- **实时进度**: 5 阶段求解进度条和耗时显示
- **结果展示**: 最优母板数、下界、Gap、节点数、利用率
- **切割可视化**: 独立窗口展示母板切割方案，支持翻页浏览
- **结果导出**: JSON 格式导出、切割图片导出

## 问题描述

**二维下料问题 (2D Cutting Stock Problem)**

给定固定尺寸的母板 (L × W) 和多种规格的子板需求，目标是用最少的母板切割出所有需求的子板。

**两阶段切割**:
- 第一阶段: 沿宽度方向将母板切割为条带
- 第二阶段: 沿长度方向将条带切割为子板

## 求解算法

**Branch and Price = Column Generation + Branch and Bound**

1. **数据读取**: 加载算例，生成 Arc Flow 网络
2. **启发式**: 对角矩阵策略生成初始可行解
3. **根节点列生成**: 求解 LP 松弛，迭代生成改进列
4. **整数性检查**: 若 LP 解为整数则直接输出
5. **分支定价**: Arc 流量分支策略求解整数最优解

**子问题求解方法**:
| 方法 | 说明 | 支持 Arc 分支 |
|------|------|---------------|
| CPLEX IP | 直接整数规划 | 否 |
| Arc Flow | 网络流模型 | 是 |
| DP | 动态规划 | 否 |

## 技术栈

- **GUI**: Qt 6.10+
- **构建**: CMake 3.24+
- **编译器**: MSVC 2022 (C++17)
- **求解器**: IBM CPLEX 22.1.0

## 项目结构

```
CS-2D-GUI/
├── CMakeLists.txt              # CMake 构建配置
├── CMakePresets.json           # 构建预设
├── src/
│   ├── main.cpp                # 程序入口
│   ├── main_window.h/cpp       # 主窗口
│   ├── parameter_widget.h/cpp  # 参数设置面板
│   ├── results_widget.h/cpp    # 结果显示面板
│   ├── log_widget.h/cpp        # 日志输出面板
│   ├── solver_worker.h/cpp     # 后台求解线程
│   ├── cutting_view_widget.h/cpp   # 切割方案绘制组件
│   └── cutting_view_dialog.h/cpp   # 切割方案可视化窗口
└── build/                      # 构建输出目录
```

## 构建

### 依赖

- Qt 6.10+ (Widgets, Core)
- IBM CPLEX 22.1.0
- CS-2D-BP-Arc 项目 (同级目录)

### 编译

```bash
# 配置
cmake --preset vs2022-release

# 构建
cmake --build build/vs2022 --config Release

# 部署 Qt 运行时
windeployqt build/vs2022/bin/Release/CS-2D-GUI.exe
```

## 输入文件格式

```csv
stock_width,stock_length
500,300

id,width,length,demand
0,180,180,3
1,120,70,4
2,80,50,4
```

## 使用

1. 点击「浏览...」选择算例文件
2. 设置时间限制和求解方法（推荐 Arc Flow）
3. 点击「开始求解」
4. 查看进度和结果
5. 点击「查看切割方案...」打开可视化窗口
6. 在可视化窗口中可加载其他结果文件或导出图片

## 界面预览

**主窗口**:
```
┌──────────────────────────────────────────────────┐
│  [浏览...] [算例文件路径]    │  参数设置         │
│  子板类型: 8  母板: 500x300  │  时间限制: 60s    │
│                              │  SP1: Arc Flow    │
│                              │  SP2: Arc Flow    │
├──────────────────────────────────────────────────┤
│  [开始求解]  [取消]               状态: 就绪     │
├──────────────────────────────────────────────────┤
│  数据读取:    [████████████] 100%    0.1s       │
│  启发式:      [████████████] 100%    0.2s       │
│  根节点 CG:   [████████░░░░]  70%    5.3s       │
│  整数性检查:  [░░░░░░░░░░░░]   0%    --         │
│  分支定价:    [░░░░░░░░░░░░]   0%    --         │
├──────────────────────────────────────────────────┤
│  求解结果            │  运行日志                 │
│  最优母板数: 5       │  [10:23:45] 开始求解...  │
│  根节点下界: 4.67    │  [10:23:45] 子板类型: 8  │
│  最优性 Gap: 7.05%   │  [10:23:46] 启发式完成   │
│  分支节点数: 12      │  [10:23:52] CG 收敛      │
│  总利用率: 89.3%     │                          │
├──────────────────────────────────────────────────┤
│  [导出 JSON...]  [查看切割方案...]   总耗时: 8.2s│
└──────────────────────────────────────────────────┘
```

**切割方案可视化窗口**:
```
┌─────────────────────────────────────────────────┐
│  [打开结果文件...]  [导出图片...]    solution.json│
├─────────────────────────────────────────────────┤
│  [<]  1 / 5  [>]              利用率: 94.2%     │
│  ┌───────────────────────────────────────────┐  │
│  │  ┌─────────┐ ┌───────┐ ┌───────┐ ┌────┐  │  │
│  │  │   T1    │ │  T2   │ │  T2   │ │ T3 │  │  │
│  │  │         │ │       │ │       │ │    │  │  │
│  │  └─────────┘ └───────┘ └───────┘ └────┘  │  │
│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐            │  │
│  │  │ T4 │ │ T4 │ │ T5 │ │ T5 │            │  │
│  │  └────┘ └────┘ └────┘ └────┘            │  │
│  └───────────────────────────────────────────┘  │
│                     500                         │
└─────────────────────────────────────────────────┘
```

## 许可证

MIT License
